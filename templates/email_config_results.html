{% if results %}
<div class="results-container">
    <!-- Server Connectivity -->
    <div class="test-group">
        <h3>Server Connectivity</h3>
        <div class="test-results">
            <div class="test-item {% if results.port_25.open %}good{% else %}bad{% endif %}">
                <span class="test-name">SMTP (Port 25)</span>
                <span class="test-status">{{ "Open" if results.port_25.open else "Closed" }}</span>
            </div>
            <div class="test-item {% if results.port_465.open %}good{% else %}bad{% endif %}">
                <span class="test-name">SMTP SSL (Port 465)</span>
                <span class="test-status">{{ "Open" if results.port_465.open else "Closed" }}</span>
            </div>
            <div class="test-item {% if results.port_587.open %}good{% else %}bad{% endif %}">
                <span class="test-name">SMTP TLS (Port 587)</span>
                <span class="test-status">{{ "Open" if results.port_587.open else "Closed" }}</span>
            </div>
        </div>
    </div>

    <!-- Mail Server Records -->
    <div class="test-group">
        <h3>Mail Server Records</h3>
        <div class="test-results">
            <div class="test-item {% if results.mx_records %}good{% else %}bad{% endif %}">
                <span class="test-name">MX Records</span>
                <span class="test-status">{{ "Configured" if results.mx_records else "Not Found" }}</span>
            </div>
            <div class="test-item {% if results.ptr_record %}good{% else %}bad{% endif %}">
                <span class="test-name">Reverse DNS (PTR)</span>
                <span class="test-status">{{ "Valid" if results.ptr_record else "Not Found" }}</span>
            </div>
        </div>
    </div>

    <!-- Mail Provider Information -->
    {% if results.providers %}
    <div class="test-group">
        <h3>Mail Provider Information</h3>
        <div class="test-results">
            {% for provider in results.providers %}
            <div class="test-item provider-item">
                <span class="test-name">
                    <i class="fas fa-{% if provider.type == 'Security Gateway' %}shield-alt{% else %}envelope{% endif %}" 
                       title="{{ provider.type }}"></i>
                    {{ provider.name }}
                    <span class="provider-tooltip" title="{% if provider.type == 'Security Gateway' %}Security gateways provide additional email filtering and protection{% else %}Direct mail provider for sending and receiving email{% endif %}">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </span>
                <span class="test-status" data-type="{{ provider.type }}">
                    {{ provider.type }}
                    {% if provider.hostname %}
                    <span class="hostname-detail">{{ provider.hostname }}</span>
                    {% endif %}
                </span>
            </div>
            {% endfor %}
            {% if results.security_risk %}
            <div class="test-item bad security-risk">
                <span class="test-name">
                    <i class="fas fa-exclamation-triangle"></i>
                    Security Risk Detected
                    <span class="provider-tooltip" title="{{ results.security_risk.description }}">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </span>
                <span class="test-status" data-risk-level="{{ results.security_risk.risk_level }}">
                    {{ results.security_risk.risk_level }}
                </span>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Server Details -->
    <div class="test-group">
        <h3>Server Details</h3>
        <div class="server-info">
            {% if results.server_details %}
                {% for detail in results.server_details %}
                    <div class="detail-line">{{ detail }}</div>
                {% endfor %}
            {% else %}
                <div class="detail-line empty">No SMTP server details available</div>
            {% endif %}
        </div>
    </div>

    <!-- Recommendations Section -->
    {% if recommendations %}
    <div class="test-group">
        <h3>Recommendations</h3>
        <div class="recommendations">
            {% for rec in recommendations %}
                <div class="recommendation-item {{ rec.severity }}">
                    <div class="rec-header">
                        <span class="severity-badge">{{ rec.severity|upper }}</span>
                        <h4 class="issue">{{ rec.issue }}</h4>
                    </div>
                    <div class="rec-details">
                        <div class="impact">
                            <span class="label">Impact:</span>
                            <span class="text">{{ rec.impact }}</span>
                        </div>
                        <div class="fix">
                            <span class="label">Fix:</span>
                            <span class="text">{{ rec.fix }}</span>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>
{% endif %} 